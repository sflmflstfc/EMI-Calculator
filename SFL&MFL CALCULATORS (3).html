<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Finance Calculators</title>
<style>
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin:0; background: #f0f2f5; }
.header { text-align: center; padding: 20px; background: #e0f0ff; color: #1e40af; border-radius: 0 0 10px 10px; }
.header h1 { margin: 0; font-size: 24px; }
.tabs { display: flex; margin: 20px auto; max-width: 900px; }
.tab { flex:1; text-align:center; padding: 12px 0; cursor:pointer; background: #e2e8f0; margin-right:2px; border-radius: 8px 8px 0 0; font-weight:bold; transition:0.3s; }
.tab:last-child { margin-right:0; }
.tab.active { background:#1e40af; color:white; }
.tab-content { display:none; max-width:900px; margin:auto; background:white; padding:20px; border-radius:0 0 10px 10px; box-shadow:0 4px 8px rgba(0,0,0,0.1); }
.tab-content.active { display:block; }
input, select { padding:10px; margin:5px 0; width:100%; border-radius:6px; border:1px solid #cbd5e1; text-align:center; }
input.yellow, select.yellow { background:#fff9c4; }
button { padding:10px 18px; margin:10px 5px 0 0; border:none; border-radius:6px; background:#1e40af; color:white; cursor:pointer; font-weight:bold; transition:0.3s; }
button:hover { background:#1e3a8a; }
h2 { color:#1e40af; margin-top:0; }
.card { border:1px solid #e2e8f0; border-radius:8px; padding:15px; background:#f8fafc; margin-bottom:15px; box-shadow:0 2px 4px rgba(0,0,0,0.05);}
.row { display:flex; justify-content:space-between; margin:2px 0; font-size:14px; }
.highlight { font-weight:bold; color:#1e40af; }
.highlight-blue { font-weight:bold; color:#0b3d91; }
.extra { font-weight:bold; color:#b91c1c; }
.grid { display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-top:20px; }
.report-header { text-align:center; font-weight:bold; margin-bottom:5px; }
.report-rupee { text-align:center; font-size:36px; font-weight:bold; color:#1e40af; margin:10px 0; }
.disclaimer { color:red; font-style:italic; margin-top:10px; text-align:center; }
@media(max-width:700px){ .grid{grid-template-columns:1fr;} .tabs{flex-direction:column;} .tab{margin-bottom:5px;} }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
</head>
<body>

<div class="header">
  <h1>Saptagiri Finance & Shree Mahalaxmi Finance</h1>
</div>

<div class="tabs">
  <div class="tab active" onclick="openTab('denomination')">Denomination</div>
  <div class="tab" onclick="openTab('preclosure')">Pre-closure</div>
  <div class="tab" onclick="openTab('emi')">EMI Calculator</div>
  <div class="tab" onclick="openTab('vehicleemi')">Vehicle EMI Report</div>
  <div class="tab" onclick="openTab('chit')">Chit Calculator</div>
</div>

<!-- Denomination Tab -->
<div id="denomination" class="tab-content active">
<h2>Denomination Calculator</h2>
₹500: <input type="number" id="d500" value="0"><br>
₹200: <input type="number" id="d200" value="0"><br>
₹100: <input type="number" id="d100" value="0"><br>
₹50: <input type="number" id="d50" value="0"><br>
₹20: <input type="number" id="d20" value="0"><br>
₹10: <input type="number" id="d10" value="0"><br>
₹5: <input type="number" id="d5" value="0"><br>
<button onclick="calculateDenomination()">Calculate Total</button>
<button onclick="exportDenominationPDF()">Export PDF</button>
<button onclick="exportDenominationJPG()">Export JPG</button>
<h3 id="denominationResult"></h3>
</div>

<!-- Pre-closure Tab -->
<div id="preclosure" class="tab-content">
<h2>Loan Pre-closure</h2>
EMI With P & I: <input type="number" id="emiWithInterest"><br>
EMI Without Interest: <input type="number" id="emiWithoutInterest"><br>
No of Future EMI With P & I: <input type="number" id="futureEmiWithInterest"><br>
No of Future EMI Without I: <input type="number" id="futureEmiWithoutInterest"><br>
Current Outstanding: <input type="number" id="currentOutstanding"><br>
<button onclick="showPreclosureManual()">Show Summary</button>
<button onclick="exportPreclosureExcel()">Export Excel</button>
<button onclick="exportPreclosurePDF()">Export PDF</button>
<button onclick="exportPreclosureJPG()">Export JPG</button>
<div id="preclosureResult"></div>
</div>

<!-- EMI Calculator Tab -->
<div id="emi" class="tab-content">
<h2>EMI Calculator</h2>
NEFT / CHQ AMOUNT: <input type="number" id="neft" class="yellow" value="95500"><br>
INTEREST PA (%): <input type="number" id="rate" class="yellow" value="11.99" step="0.01"><br>
PROCESSING FEES: <input type="number" id="fees" class="yellow" value="4500"><br>
DEALER INCENTIVE / OTHER EXPENSES: <input type="number" id="dealer" class="yellow" value="1000"><br>
LOAN TERM (Months, e.g. 12,18,24,36): <input type="text" id="terms" class="yellow" value="12,18,24,36"><br>
Interest Type: <select id="type" class="yellow"><option>Flat</option><option>Reducing</option></select><br>
<button onclick="generateEMIReport()">Generate Report</button>
<button onclick="exportEMIPDF()">Export PDF</button>
<button onclick="exportEMIJPG()">Export JPG</button>
<div id="report"></div>
</div>

<!-- Vehicle EMI Report Tab -->
<div id="vehicleemi" class="tab-content">
<h2>Vehicle EMI Report — PERSONAL LOAN</h2>
<div class="row">
  <input id="vprice" type="number" placeholder="Vehicle Price" value="115000">
  <input id="vdown" type="number" placeholder="Down Payment" value="34999">
  <input id="vdealer" type="number" placeholder="Dealer Incentive" value="1000">
</div>
<div class="row">
  <input id="vproc" type="number" placeholder="Processing Fees" value="4800">
  <input id="vroi" type="number" step="0.01" placeholder="ROI % (pa)" value="11.99">
  <input id="vterm" type="text" placeholder="Term(s) in months, e.g., 12,24,36" value="12,18,24,36">
</div>
<div class="row">
  <button id="generateVehicleEMI">Generate Report(s)</button>
  <button id="downloadVehiclePdf">Download PDF</button>
  <button id="downloadVehicleImg">Download Image</button>
</div>
<div id="vehicleReport" class="grid"></div>
</div>

<!-- Chit Fund Tab -->
<div id="chit" class="tab-content">
<h2>Chit Fund Calculator</h2>
<label>No. of Members: <input type="number" id="members" value="10"></label><br><br>
<label>Term (months): <input type="number" id="term" value="12"></label><br><br>
<label>Monthly Subscription: <input type="number" id="subscription" value="10000"></label><br><br>
<label>No. of Payable Members per Month: <input type="number" id="payable" value="10"></label><br><br>
<label>Deduction % (comma-separated for each month): 
<input type="text" id="deductions" value="5,4,3,2,1,1,1,1,1,1,1,1">
</label><br><br>

<button onclick="generateSchedule()">Generate Schedule</button>
<button onclick="exportChitPDF()">Export PDF</button>
<button onclick="exportChitExcel()">Export Excel</button>
<button onclick="exportChitImage()">Export Image</button>

<div id="dealResult"></div>
<div id="schedule"></div>
</div>

<script>
// Tab Switching
function openTab(tabId){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
  document.querySelector('.tab[onclick="openTab(\''+tabId+'\')"]').classList.add('active');
  document.getElementById(tabId).classList.add('active');
}

// Format numbers
function fmt(n){ return "₹"+Number(n).toLocaleString(); }
function fmt2(x){ return (isFinite(x)? Number(x).toLocaleString('en-IN',{minimumFractionDigits:2,maximumFractionDigits:2}) : '-') }

// --- Denomination ---
function calculateDenomination(){
  let total=0;
  total += Math.ceil(parseInt(document.getElementById('d500').value||0)*500);
  total += Math.ceil(parseInt(document.getElementById('d200').value||0)*200);
  total += Math.ceil(parseInt(document.getElementById('d100').value||0)*100);
  total += Math.ceil(parseInt(document.getElementById('d50').value||0)*50);
  total += Math.ceil(parseInt(document.getElementById('d20').value||0)*20);
  total += Math.ceil(parseInt(document.getElementById('d10').value||0)*10);
  total += Math.ceil(parseInt(document.getElementById('d5').value||0)*5);
  document.getElementById('denominationResult').innerHTML = `<div class="report-rupee">₹</div>
  <div class="report-header">Report Generated On: ${new Date().toLocaleString()}</div>
  <div class="card">Total Amount: ₹${total}</div>
  <div class="disclaimer">*** This EMI Calculator is For Illustrative Purpose Only</div>`;
}

// --- Pre-closure ---
function showPreclosureManual(){
  const emiWithInt = Number(document.getElementById('emiWithInterest').value);
  const emiWithoutInt = Number(document.getElementById('emiWithoutInterest').value);
  const futureWith = Number(document.getElementById('futureEmiWithInterest').value);
  const futureWithout = Number(document.getElementById('futureEmiWithoutInterest').value);
  const currentOutstanding = Number(document.getElementById('currentOutstanding').value);

  const total = (emiWithInt * futureWith) + (emiWithoutInt * futureWithout) + currentOutstanding;

  document.getElementById('preclosureResult').innerHTML = `<div class="card">
  <div class="row"><div>EMI With Interest × Future EMI With Interest</div><div>${fmt2(emiWithInt * futureWith)}</div></div>
  <div class="row"><div>EMI Without Interest × Future EMI Without Interest</div><div>${fmt2(emiWithoutInt * futureWithout)}</div></div>
  <div class="row"><div>Current Outstanding</div><div>${fmt2(currentOutstanding)}</div></div>
  <div class="row highlight"><div>Total Pre-closure Amount</div><div>${fmt2(total)}</div></div>
  </div>`;
}

// --- EMI Calculator ---
function calcScheme(neft, rate, fees, dealer, type, term){
  const monthlyRate = rate/12/100;
  let advance = (term===12)?1:2;
  let S = neft + fees + dealer;
  let EMI = 0;
  for(let i=0;i<50;i++){
    if(type==="Flat"){
      EMI = (S + S*(rate/100)*(term/12))/term;
    } else {
      const r = monthlyRate;
      EMI = (S*r*Math.pow(1+r,term))/(Math.pow(1+r,term)-1);
    }
    const advAmt = advance*EMI;
    const newS = neft + fees + dealer + advAmt;
    if(Math.abs(newS - S) < 0.01){ S=newS; break; }
    S = newS;
  }
  EMI = Math.ceil(EMI);
  let totalPay = Math.ceil(EMI*term);
  let extra = Math.ceil(EMI*(term-advance)-neft);
  let loanAmount = Math.ceil(S);
  return {term, sanctioned:loanAmount, emi:EMI, advance, payableEmis:term-advance, totalPay, extra};
}

function generateEMIReport(){
  const neft=Number(document.getElementById("neft").value);
  const rate=Number(document.getElementById("rate").value);
  const fees=Number(document.getElementById("fees").value);
  const dealer=Number(document.getElementById("dealer").value);
  const type=document.getElementById("type").value;
  const terms=document.getElementById("terms").value.split(",").map(x=>Number(x.trim())).filter(x=>x>0);

  let html='<div class="report-rupee">₹</div>';
  html += `<div class="report-header">Report Generated On: ${new Date().toLocaleString()}</div>`;
  html += `<div class="disclaimer">*** This EMI Calculator is For Illustrative Purpose Only</div>`;
  html += '<div class="grid">';
  terms.forEach(t=>{
    const r = calcScheme(neft,rate,fees,dealer,type,t);
    html+=`<div class="card">
      <div class="row"><div>LOAN AMOUNT</div><div>${fmt(r.sanctioned)}</div></div>
      <div class="row highlight-blue"><div>NEFT / CHQ AMOUNT</div><div>${fmt(neft)}</div></div>
      <div class="row"><div>RATE OF INTEREST (%)</div><div>${rate.toFixed(2)}</div></div>
      <div class="row"><div>TERM</div><div>${r.term}</div></div>
      <div class="row"><div>ADVANCE EMI</div><div>${r.advance}</div></div>
      <div class="row highlight"><div>MONTHLY EMI</div><div>${fmt(r.emi)}</div></div>
      <div class="row highlight"><div>PAYABLE EMI</div><div>${r.payableEmis}</div></div>
      <div class="row"><div>TOTAL PAYABLE</div><div>${fmt(r.totalPay)}</div></div>
      <div class="row extra"><div>EXTRA TO BE PAID</div><div>${fmt(r.extra)}</div></div>
    </div>`;
  });
  html += '</div>';
  document.getElementById("report").innerHTML = html;
}

// --- Vehicle EMI ---
document.getElementById("generateVehicleEMI").addEventListener("click",()=>{
  const V = Number(document.getElementById("vprice").value);
  const D = Number(document.getElementById("vdown").value);
  const DI = Number(document.getElementById("vdealer").value);
  const PF = Number(document.getElementById("vproc").value);
  const ROI = Number(document.getElementById("vroi").value);
  const terms = document.getElementById("vterm").value.split(",").map(x=>Number(x.trim())).filter(x=>x>0);
  const now = new Date();
  let dt = now.toLocaleString();

  let html = "";
  terms.forEach(T=>{
    const adv = (T<=12)?1:2;
    const factorA = (1 + (ROI/100)*(T/12))/T;
    const baseS = V - D + DI + PF;
    const denom = 1 - adv*factorA;
    let sanctioned = (denom>0)? Math.ceil(baseS/denom) : NaN;
    const emi = Math.ceil(sanctioned*factorA);
    const advAmount = adv*emi;
    const dealerPayment = V - D + PF;
    const totalPayment = emi*(T-adv);
    const noOfPayableEMI = T-adv;
    const totalExtraPayment = totalPayment + D - V;

    html += `<div class="card">
      <div class="row"><div>Date & Time</div><div>${dt}</div></div>
      <div class="row"><div>Vehicle Price</div><div>${fmt2(V)}</div></div>
      <div class="row"><div>Down Payment</div><div>${fmt2(D)}</div></div>
      <div class="row"><div>Sanctioned Loan Amount</div><div>${fmt2(sanctioned)}</div></div>
      <div class="row"><div>Loan Term (months)</div><div>${T}</div></div>
      <div class="row"><div>ROI (%)</div><div>${fmt2(ROI)}</div></div>
      <div class="row highlight"><div>Calculated EMI</div><div>${fmt2(emi)}</div></div>
      <div class="row"><div>No Of Payable EMI</div><div>${noOfPayableEMI}</div></div>
      <div class="row"><div>Advance EMIs</div><div>${adv} (₹ ${fmt2(advAmount)})</div></div>
      <div class="row"><div>Processing Fees</div><div>${fmt2(PF)}</div></div>
      <div class="row"><div>Dealer Payment</div><div>${fmt2(dealerPayment)}</div></div>
      <div class="row"><div>Total Payment</div><div>${fmt2(totalPayment)}</div></div>
      <div class="row extra"><div>Total Extra Payment</div><div>${fmt2(totalExtraPayment)}</div></div>
    </div>`;
  });
  document.getElementById("vehicleReport").innerHTML = html;
});

// --- Chit Fund ---
function generateSchedule() {
  const members = parseInt(document.getElementById('members').value);
  const term = parseInt(document.getElementById('term').value);
  const S = parseFloat(document.getElementById('subscription').value);
  const P = parseInt(document.getElementById('payable').value);
  let deductions = document.getElementById('deductions').value.split(",").map(Number);

  if(deductions.length !== term) { alert("Deduction % length must equal Term months!"); return; }

  let html = "<table><tr><th>Month</th><th>Total Paid So Far</th><th>Future Collection</th><th>Deduction %</th><th>Deduction (per member)</th><th>Month Payout</th></tr>";
  let totalBalance = 0;
  let totalDeductionPerMember = 0;

  for(let m=1; m<=term; m++){
    let paidSoFar = S*m;
    let futureCollection = (S*term) - paidSoFar;

    let deductionPerMember = (deductions[m-1]/100) * futureCollection;
    let monthPayout = (P * S) - deductionPerMember;
    let deductionClass = deductionPerMember > 0 ? 'green' : (deductionPerMember < 0 ? 'red' : '');
    let payoutClass = monthPayout >= 0 ? 'green' : 'red';

    html += `<tr>
      <td>${m}</td>
      <td>${paidSoFar.toFixed(2)}</td>
      <td>${futureCollection.toFixed(2)}</td>
      <td>${deductions[m-1]}%</td>
      <td class="${deductionClass}">${deductionPerMember.toFixed(2)}</td>
      <td class="${payoutClass}">${monthPayout.toFixed(2)}</td>
    </tr>`;

    totalBalance += monthPayout;
    totalDeductionPerMember += deductionPerMember;
  }

  html += `<tr>
    <th colspan="4">Total Deduction (per member)</th>
    <th class="${totalDeductionPerMember>0?'green':'red'}">${totalDeductionPerMember.toFixed(2)}</th>
    <th></th>
  </tr>`;

  html += `<tr>
    <th colspan="5">Total Payout</th>
    <th class="green">${totalBalance.toFixed(2)}</th>
  </tr>`;

  html += "</table>";
  document.getElementById('schedule').innerHTML = html;

  document.getElementById('dealResult').innerHTML = totalBalance>=0
    ? "<h3 class='green'>GOOD DEAL ✅</h3>"
    : "<h3 class='red'>WRONG DEAL ❌</h3>";
}

// --- Export functions ---
function exportEMIPDF(){ const { jsPDF } = window.jspdf; const doc=new jsPDF('p','pt','a4'); html2canvas(document.getElementById("report")).then(canvas=>{ const img=canvas.toDataURL("image/png"); const props=doc.getImageProperties(img); const pdfW=doc.internal.pageSize.getWidth(); const pdfH=(props.height*pdfW)/props.width; doc.addImage(img,'PNG',0,0,pdfW,pdfH); doc.save("EMI_Report.pdf"); }); }
function exportEMIJPG(){ html2canvas(document.getElementById("report")).then(canvas=>{ const link=document.createElement('a'); link.download="EMI_Report.jpg"; link.href=canvas.toDataURL('image/jpeg',1.0); link.click(); }); }
document.getElementById("downloadVehiclePdf").addEventListener("click",()=>{ const { jsPDF } = window.jspdf; const doc=new jsPDF('p','pt','a4'); html2canvas(document.getElementById("vehicleReport")).then(canvas=>{ const img=canvas.toDataURL("image/png"); const props=doc.getImageProperties(img); const pdfW=doc.internal.pageSize.getWidth(); const pdfH=(props.height*pdfW)/props.width; doc.addImage(img,'PNG',0,0,pdfW,pdfH); doc.save("VehicleEMI_Report.pdf"); }); });
document.getElementById("downloadVehicleImg").addEventListener("click",()=>{ html2canvas(document.getElementById("vehicleReport")).then(canvas=>{ const link=document.createElement('a'); link.download="VehicleEMI_Report.jpg"; link.href=canvas.toDataURL('image/jpeg',1.0); link.click(); }); });

function exportChitPDF() { const doc = new jspdf.jsPDF(); html2canvas(document.getElementById('schedule')).then(canvas => { const imgData = canvas.toDataURL('image/png'); const pdfWidth = doc.internal.pageSize.getWidth()-20; const pdfHeight = canvas.height * pdfWidth / canvas.width; doc.addImage(imgData, 'PNG', 10, 10, pdfWidth, pdfHeight); doc.save('ChitFund.pdf'); }); }
function exportChitExcel() { const table = document.querySelector('#schedule table'); if(!table){ alert('Generate schedule first'); return; } const wb = XLSX.utils.table_to_book(table,{sheet:"ChitFund"}); XLSX.writeFile(wb,'ChitFund.xlsx'); }
function exportChitImage() { html2canvas(document.getElementById('schedule')).then(canvas => { const link = document.createElement('a'); link.href = canvas.toDataURL(); link.download = 'ChitFund.png'; link.click(); }); }
</script>

</body>
</html>
